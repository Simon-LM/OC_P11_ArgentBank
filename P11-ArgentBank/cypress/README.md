<!-- @format -->

# Plan d'int√©gration de Cypress dans ArgentBank

Ce document pr√©sente une strat√©gie pour l'int√©gration de Cypress comme outil de tests end-to-end (E2E) dans le projet ArgentBank, en compl√©ment des tests unitaires et d'int√©gration existants avec Vitest.

## üìã Vue d'ensemble

### Positionnement dans la strat√©gie de test

```
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ   Tests E2E     ‚îÇ
                    ‚îÇ    (Cypress)    ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇTests d'int√©gration‚îÇ
                    ‚îÇ    (Vitest)     ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ  Tests unitaires ‚îÇ
                    ‚îÇ     (Vitest)    ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Compl√©mentarit√© avec les tests existants

| Type de test | Outil   | Objectif                                           | Focus                           |
| ------------ | ------- | -------------------------------------------------- | ------------------------------- |
| Unitaire     | Vitest  | V√©rifier les fonctions isol√©es                     | Comportement individuel         |
| Int√©gration  | Vitest  | V√©rifier les interactions entre modules            | Workflows internes              |
| E2E          | Cypress | V√©rifier l'application du point de vue utilisateur | Exp√©rience utilisateur compl√®te |

## üõ†Ô∏è Installation et configuration

### Installation de Cypress

```bash
# Installer Cypress comme d√©pendance de d√©veloppement
pnpm add -D cypress

# Installer les plugins recommand√©s
pnpm add -D @testing-library/cypress cypress-axe cypress-real-events
```

### Structure de dossiers propos√©e

```
cypress/
‚îú‚îÄ‚îÄ e2e/                      # Tests E2E organis√©s par fonctionnalit√©
‚îÇ   ‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login.cy.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ logout.cy.js
‚îÇ   ‚îú‚îÄ‚îÄ accounts/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ view-accounts.cy.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ account-details.cy.js
‚îÇ   ‚îî‚îÄ‚îÄ transactions/
‚îÇ       ‚îú‚îÄ‚îÄ search.cy.js
‚îÇ       ‚îî‚îÄ‚îÄ filtering.cy.js
‚îú‚îÄ‚îÄ fixtures/                 # Donn√©es de test
‚îÇ   ‚îú‚îÄ‚îÄ users.json
‚îÇ   ‚îú‚îÄ‚îÄ accounts.json
‚îÇ   ‚îî‚îÄ‚îÄ transactions.json
‚îú‚îÄ‚îÄ support/                  # Helpers et commandes personnalis√©es
‚îÇ   ‚îú‚îÄ‚îÄ commands.js
‚îÇ   ‚îú‚îÄ‚îÄ auth-commands.js
‚îÇ   ‚îú‚îÄ‚îÄ e2e.js
‚îÇ   ‚îî‚îÄ‚îÄ component.js
‚îî‚îÄ‚îÄ components/               # Tests de composants isol√©s (optionnel)
    ‚îú‚îÄ‚îÄ Button.cy.js
    ‚îî‚îÄ‚îÄ TransactionTable.cy.js
```

### Configuration de base

```javascript
// cypress.config.js
const { defineConfig } = require("cypress");

module.exports = defineConfig({
	e2e: {
		baseUrl: "http://localhost:5173",
		specPattern: "cypress/e2e/**/*.cy.{js,jsx,ts,tsx}",
		viewportWidth: 1280,
		viewportHeight: 720,
		video: false,
		screenshotOnRunFailure: true,
		experimentalRunAllSpecs: true,
	},
	component: {
		devServer: {
			framework: "react",
			bundler: "vite",
		},
		specPattern: "cypress/components/**/*.cy.{js,jsx,ts,tsx}",
	},
	env: {
		apiUrl: "http://localhost:3001/api/v1",
	},
});
```

## üß™ Strat√©gie de test

### Sc√©narios prioritaires

1. **Authentification**

   - Connexion r√©ussie
   - √âchecs de connexion (identifiants incorrects)
   - D√©connexion
   - Persistance de session

2. **Gestion de profil**

   - Visualisation des informations de profil
   - Modification du nom d'utilisateur
   - Validation des formulaires

3. **Comptes bancaires**

   - Affichage de la liste des comptes
   - S√©lection d'un compte
   - V√©rification des soldes

4. **Transactions**
   - Recherche de transactions
   - Filtrage par date/montant/cat√©gorie
   - Pagination
   - Affichage des d√©tails

### Approche bas√©e sur les parcours utilisateurs

Pour chaque fonctionnalit√©, structurer les tests selon les parcours utilisateurs typiques :

```javascript
// cypress/e2e/auth/login.cy.js
describe("Login Process", () => {
	beforeEach(() => {
		cy.visit("/signin");
	});

	it("allows a user to log in successfully", () => {
		cy.fixture("users").then((users) => {
			const user = users[0];
			cy.get("[data-testid=email-input]").type(user.email);
			cy.get("[data-testid=password-input]").type(user.password);
			cy.get("[data-testid=login-button]").click();

			cy.url().should("include", "/user");
			cy.get("[data-testid=user-greeting]").should(
				"contain",
				`${user.firstName} ${user.lastName}`
			);
		});
	});

	it("shows error message with incorrect credentials", () => {
		cy.get("[data-testid=email-input]").type("wrong@example.com");
		cy.get("[data-testid=password-input]").type("wrongpassword");
		cy.get("[data-testid=login-button]").click();

		cy.get("[data-testid=error-message]")
			.should("be.visible")
			.and("contain", "Invalid credentials");
	});
});
```

## üîÑ Int√©gration avec le reste de la suite de tests

### Scripts dans package.json

```json
{
	"scripts": {
		"cypress:open": "cypress open",
		"cypress:run": "cypress run",
		"test:e2e": "cypress run",
		"test:e2e:headed": "cypress run --headed",
		"test:all": "pnpm test && pnpm test:e2e"
	}
}
```

### Int√©gration CI/CD

```yaml
# .github/workflows/e2e-tests.yml
name: E2E Tests

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  cypress-run:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "18"

      - name: Setup pnpm
        uses: pnpm/action-setup@v2
        with:
          version: latest

      - name: Install dependencies
        run: pnpm install

      - name: Build app
        run: pnpm build

      - name: Start server
        run: pnpm preview &

      - name: Run Cypress tests
        uses: cypress-io/github-action@v6
        with:
          browser: chrome
          record: true
        env:
          CYPRESS_RECORD_KEY: ${{ secrets.CYPRESS_RECORD_KEY }}
```

## üß† Bonnes pratiques

### Structure des tests

```javascript
// Pattern recommand√©
describe("Feature: Component or Page", () => {
	beforeEach(() => {
		// Setup commun (navigation, authentification)
	});

	context("Given a certain state", () => {
		beforeEach(() => {
			// Setup sp√©cifique au contexte
		});

		it("should behave as expected when action performed", () => {
			// Arrange (pr√©paration sp√©cifique au test)
			// Act (actions utilisateur)
			// Assert (v√©rifications)
		});
	});
});
```

### Commandes personnalis√©es

```javascript
// cypress/support/auth-commands.js
Cypress.Commands.add("login", (email, password) => {
	cy.session([email, password], () => {
		cy.visit("/signin");
		cy.get("[data-testid=email-input]").type(email);
		cy.get("[data-testid=password-input]").type(password);
		cy.get("[data-testid=login-button]").click();
		cy.url().should("include", "/user");
	});
});

// Usage
cy.login("tony@stark.com", "password123");
```

### Gestion des donn√©es de test

```javascript
// cypress/fixtures/users.json
[
	{
		id: "1",
		email: "tony@stark.com",
		password: "password123",
		firstName: "Tony",
		lastName: "Stark",
		userName: "Iron",
	},
	{
		id: "2",
		email: "steve@rogers.com",
		password: "password456",
		firstName: "Steve",
		lastName: "Rogers",
		userName: "Cap",
	},
];

// Usage
cy.fixture("users").then((users) => {
	const testUser = users[0];
	cy.login(testUser.email, testUser.password);
});
```

## ‚ôø Tests d'accessibilit√© int√©gr√©s - IMPL√âMENT√âS ‚úÖ

### Statut d'impl√©mentation

‚úÖ **TERMIN√â** - Tests d'accessibilit√© avec `cypress-axe` int√©gr√©s dans toute l'application ArgentBank.

**Couverture actuelle :**

- üîê **Authentification** : 5 tests (login, logout)
- üë§ **Profil utilisateur** : 8 tests (affichage, √©dition)
- üè¶ **Comptes bancaires** : 3 tests (liste, s√©lection)
- üí≥ **Transactions** : 6 tests (tableau, pagination, recherche)

**Total : 22 tests E2E avec v√©rifications d'accessibilit√© WCAG 2.1 AA**

### Configuration impl√©ment√©e

```typescript
// cypress/support/e2e.ts
import "cypress-axe";

// Pattern d'utilisation dans tous les tests
it("devrait √™tre accessible", () => {
	cy.injectAxe();
	cy.checkA11y(undefined, {
		rules: { "color-contrast": { enabled: false } },
	});
});
```

### Scripts disponibles

```bash
# Tests E2E avec accessibilit√©
pnpm run test:e2e:a11y

# Tests avec rapports consolid√©s
pnpm run test:e2e:a11y:report

# Nettoyage des rapports
pnpm run test:e2e:clean
```

### üìö Documentation compl√®te

| Document                                                      | Objectif                 | Public cible |
| ------------------------------------------------------------- | ------------------------ | ------------ |
| **[Guide Technique Complet](./doc/ACCESSIBILITY_TESTS.md)**   | Impl√©mentation d√©taill√©e | D√©veloppeurs |
| **[Meilleures Pratiques](./doc/BEST_PRACTICES.md)**           | Standards et patterns    | √âquipe tech  |
| **[Guide TypeScript](./doc/TYPESCRIPT_GUIDE.md)**             | Types et interfaces      | D√©veloppeurs |
| **[Tests E2E + Accessibilit√©](./doc/E2E_TESTS.md)**           | Guide int√©gr√©            | Tous         |
| **[Statut d'Impl√©mentation](./doc/IMPLEMENTATION_STATUS.md)** | Rapport final            | Management   |

## üìä Strat√©gie de reporting

### Rapports d√©taill√©s

```bash
# Installation de Mochawesome pour des rapports am√©lior√©s
pnpm add -D cypress-mochawesome-reporter

# Configuration dans cypress.config.js
module.exports = defineConfig({
  e2e: {
    // Autres configurations...
    reporter: 'cypress-mochawesome-reporter',
    reporterOptions: {
      charts: true,
      reportPageTitle: 'ArgentBank E2E Tests',
      embeddedScreenshots: true,
      inlineAssets: true,
    },
  },
});
```

### Dashboard Cypress (optionnel)

```bash
# Configuration du projet pour le dashboard
npx cypress open --project-id <your-project-id>
```

## üöÄ Plan de mise en ≈ìuvre

### Phase 1 : Installation et configuration

1. Installer Cypress et les plugins
2. Configurer l'environnement de base
3. Cr√©er la structure de dossiers
4. Ajouter les scripts npm

### Phase 2 : Premiers tests critiques

1. Impl√©menter les tests d'authentification
2. Impl√©menter les tests de profil utilisateur
3. Cr√©er les commandes personnalis√©es pour ces sc√©narios

### Phase 3 : Expansion

1. Impl√©menter les tests de comptes et transactions
2. Ajouter les tests d'accessibilit√©
3. Int√©grer au pipeline CI

### Phase 4 : Optimisation

1. Analyser les performances des tests
2. Optimiser les tests lents
3. Am√©liorer les rapports

## üìù Documentation

### README.md pour Cypress

Cr√©er un fichier README.md dans le dossier Cypress :

````markdown
# Tests E2E Cypress - ArgentBank

## üöÄ D√©marrage rapide

```bash
# Ouvrir l'interface Cypress
pnpm cypress:open

# Ex√©cuter tous les tests en mode headless
pnpm test:e2e
```
````

## üìÇ Organisation

- `e2e/` - Tests par fonctionnalit√©
- `fixtures/` - Donn√©es de test
- `support/` - Commandes personnalis√©es

## üîç Commandes personnalis√©es

- `cy.login(email, password)` - Se connecter
- `cy.checkAccount(accountId)` - V√©rifier les d√©tails d'un compte
- `cy.searchTransactions(criteria)` - Rechercher des transactions

```

---

Ce plan fournit une base solide pour l'int√©gration de Cypress dans le projet ArgentBank, compl√©mentant ainsi les tests Vitest existants pour une couverture de test compl√®te.

## üìö Documentation Compl√®te

### üéØ Guides Principaux
- **[Tests E2E](./doc/E2E_TESTS.md)** - Guide complet des tests end-to-end avec exemples
- **[Tests d'Accessibilit√©](./doc/ACCESSIBILITY_TESTS.md)** - Guide technique cypress-axe complet
- **[Meilleures Pratiques](./doc/BEST_PRACTICES.md)** - Standards et patterns recommand√©s

### üîß Guides Techniques
- **[TypeScript](./doc/TYPESCRIPT_GUIDE.md)** - Guide concis des types TypeScript pour Cypress
- **[Installation](./doc/INSTALLATION.md)** - Configuration et setup initial
- **[Maintenance](./doc/MAINTENANCE.md)** - Maintenance et troubleshooting

### üìä Statut du Projet
- **[R√©solution TypeScript](./doc/TYPESCRIPT_RESOLUTION_FINAL.md)** - Rapport final de r√©solution des conflits TypeScript
- **[Statut d'Impl√©mentation](./doc/IMPLEMENTATION_STATUS.md)** - Rapport final des tests d'accessibilit√©

### üöÄ Scripts Utilitaires
- **[clean-reports.sh](./clean-reports.sh)** - Nettoyage des rapports de tests

**Prochaine √©tape recommand√©e** : Consulter [doc/ACCESSIBILITY_TESTS.md](./doc/ACCESSIBILITY_TESTS.md) pour comprendre l'impl√©mentation compl√®te des tests d'accessibilit√©.
```
